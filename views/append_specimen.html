
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <script type="text/javascript" src="../../../public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
    <!--script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script-->
    <script type="text/javascript" src="../../../assets/js/jquery.min.js"></script>

    <script type="text/javascript" src="../../../assets/js/post_parameters.js"></script>
    <script type="text/javascript" src="../../../assets/js/generic_ajaxrequest.js"></script>
    <script type="text/javascript" src="../../../assets/js/alertifyjs/alertify.js"></script>
    <!--script type="text/javascript" src="../../../assets/js/does_connection_exist.js"></script-->
    <script type="text/javascript" src="../../../assets/js/moment.js"></script>

    <link rel="stylesheet" href="../../../assets/css/alertifyjs/css/alertify.css" type="text/css">

    
    <script type="text/javascript">
      

    </script>

    <style>
      #tt_page_select_specimen #clearButton, .tt_controls_select_specimen #clearButton {
        display: none;
      }

      #tt_page_confirmation #clearButton, .tt_controls_confirmation #clearButton {
        display: none;
      } 
      
      


      #report-cover {
        position: absolute;
        background-color: black;
        width: 100%;
        height: 102%;
        left: 0%;
        top: 0%;
        z-index: 990;
        opacity: 0.65;
        display: inline;
      }

      #spinner {
        position: absolute;
        top: 150px;
        left: 40%;
        z-index: 991;
        display: inline;
      }
    </style>

  </head>




<body id="mateme">
  <div id="container">
      <div id="content">
  
  
          <form action="post">

            

             <select allowFreeText="false" helpText="Select Specimen"
                tt_onLoad=""
                id="select_specimen" name="reason" tt_pageStyleClass="NoKeyboard">
            </select>
  
           

          </form>
  
      </div>
  </div>

  <img src="/../../assets/images/formloader.gif" id="spinner" />
  <div id="report-cover"></div>
  </body>


  <script>

var mainUrl = window.location.href;
mainUrl = new URL(mainUrl);
var accessionNumber = mainUrl.searchParams.get("accession_number");

function fetchOrder(){
  let url = apiProtocol + "://" + apiURL + ":" + apiPort + "/api/v1/lab/orders";
  url += "?accession_number=" + accessionNumber;

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
      let orders = JSON.parse(this.responseText);
      for(let i = 0; i < orders.length; i++){
        let tests = orders[i].tests;
        for(let t  =  0; t < tests.length; t++){
          selectedTests.push([tests[t].concept_id, tests[i].name]);
        }
        fetchSpecimen();
      }
    }
  };
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
  xhttp.setRequestHeader('Content-type', "application/json");
  xhttp.send(); 
}

function fetchSpecimen(){
  let url = apiProtocol + "://" + apiURL + ":" + apiPort + "/api/v1/lab/specimen_types";
  let specimen = [{
    concept_id: selectedTests[0][0],
    name: selectedTests[0][1]
  }];
  //specimen = JSON.stringify(specimen);
  //alert(specimen);

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
      let orders = JSON.parse(this.responseText);
      console.log(orders);
    }
  };
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
  xhttp.setRequestHeader('Content-type', "application/json");
  xhttp.send(specimen); 
}

var selectedTests = [];
fetchOrder();
</script>



</html>