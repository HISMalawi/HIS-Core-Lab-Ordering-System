
<!-- <script src="/assets/js/HighCharts/highcharts.js"></script>
<script src="/assets/js/HighCharts/highcharts-3d.js"></script>
<script src="/assets/js/HighCharts/exporting.js"></script>
<script src="/assets/js/HighCharts/export-data.js"></script> -->

<script src="/assets/js/jquery.min.js"></script> 
<script src="../../../assets/js/datatables/datatables.js"></script>
<link rel="stylesheet" type="text/css" href="../../../assets/css/datatables/jquery.dataTables.min.css"/>

<script src="/assets/js/moment.js"></script>

<script src="/assets/js/core.js"></script> 


<style>

#lab-stats-table {
  width: 95%;
  border-style: solid;
  border-width: 1px;
  border-collapse: collapse;
}

.stat-boxes {
  background-color: #ccc;
  text-align: right;
}

th {
  padding-right: 15px;
  height: 40px;
  color: black;
}

.text-right {
  text-align: right;
  padding-right: 5px;
}

td {
  border-style: solid;
  border-width: 1px;
}

.text-left {
  text-align: left;
}

</style>

<div id='lab-stats'>

<table id='lab-stats-table'>
  <thead>
    <tr class='stat-boxes'>
      <th>Test</th>
      <th>Ordered</th>
      <th>Drawn</th>
    </tr>
  </thead>
</table>


</div>

<script>

function dashboardStats(stats, order_status) {
  for(let i = 0; i < stats.length; i++){
    let tests = stats[i].tests;

    for(let t = 0; t < tests.length; t++){
      let test_name = tests[t].name;
      if(orders[test_name] == undefined)
        orders[test_name] = {
          ordered: 0, drawn: 0
        }
      
      if(order_status == 'ordered')
        orders[test_name].ordered += 1;

      if(order_status == 'drawn')
        orders[test_name].drawn += 1;

    }
    
  }

  (order_status == 'ordered' ? fetchDashboardStats('drawn') : renderResults());
}

function renderResults(){
  data_table.clear();
  for(let test_name in orders){
    data_table.row.add([test_name, orders[test_name].ordered, orders[test_name].drawn]).draw();
  }
}

var orders = {};

function fetchDashboardStats(order_status) {
  let url = sessionStorage.apiProtocol+ '://' + sessionStorage.apiURL + ':' 
  url += sessionStorage.apiPort + `/api/v1/lab/orders?status=${order_status}`;
  url += "&date=" + sessionStorage.sessionDate;

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
      var obj = JSON.parse(this.responseText);
      dashboardStats(obj, order_status);
    }
  };
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
  xhttp.setRequestHeader('Content-type', "application/json");
  xhttp.send();
}

var data_table;

function initializeTable() {
  data_table = $('#lab-stats-table').DataTable({
      fixedHeader: true,
      searching: false,
      paging: false,
      scrollY: 430,
      scroller: {
          loadingIndicator: true
      },
      columnDefs: [
        {"className": "text-left", "targets": 0}, 
        {"className": "text-right", "targets": 1}, 
        {"className": "text-right", "targets": 2} 
      ]
    });
}

setTimeout("fetchDashboardStats('ordered')", 200);
initializeTable();
</script>

